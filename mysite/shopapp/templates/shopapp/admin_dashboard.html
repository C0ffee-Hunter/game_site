{% extends 'shopapp/base.html' %}

{% block title %}–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | Control Center{% endblock %}

{% block content %}
<div class="admin-wrapper fade-in">
    <div class="admin-header">
        <h1>–ê–¥–º–∏–Ω <span>–ø–∞–Ω–µ–ª—å</span></h1>
        <div class="stats-bar">
            <div class="stat-item">–ò–≥—Ä: <span>{{ total_games }}</span></div>
            <div class="stat-item">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: <span>{{ total_users }}</span></div>
        </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="admin-tabs">
        <button class="tab-btn active" onclick="openTab('games')">üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏</button>
        <button class="tab-btn" onclick="openTab('users')">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –ò–≥—Ä -->
    <div id="games" class="tab-content active">
        <div class="content-header">
          <h2>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö <span>–∏–≥—Ä</span></h2>
            <a href="game/add/" class="btn-cyber-add">
              <span class="plus-icon">+</span>
              <span class="btn-text">–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä—É</span>
              <div class="btn-glitch"></div>
            </a>
        </div>
        <table class="cyber-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–ñ–∞–Ω—Ä</th>
                    <th>–†–µ–π—Ç–∏–Ω–≥</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for game in games %}
                <tr>
                    <td>#{{ game.game_id }}</td>
                    <td class="text-white">{{ game.title }}</td>
                    <td>{{ game.genre }}</td>
                    <td class="text-accent">{{ game.rating }}</td>
                    <td class="table-actions">
    <div class="action-group">
        <!-- –ö–Ω–æ–ø–∫–∞ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å -->
        <a href="{% url 'admin_game_edit' game.game_id %}" class="admin-btn-hex edit">‚úèÔ∏è</a>

        <!-- –ö–Ω–æ–ø–∫–∞ –£–¥–∞–ª–∏—Ç—å -->
        <form action="{% url 'admin_delete_game' game.game_id %}" method="post" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É –∏–∑ —Å–∏—Å—Ç–µ–º—ã?')">
            {% csrf_token %}
            <button type="submit" class="admin-btn-hex delete" title="–°—Ç–µ—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ">
                <span class="icon">üóë</span>
            </button>
        </form>
    </div>
</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div id="users" class="tab-content">
        <table class="cyber-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Email</th>
                    <th>–†–æ–ª—å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
<tr>
    <td>#{{ u.user_id }}</td>
    <td class="text-white">{{ u.email }}</td>
    <td>
        <span class="role-tag {{ u.role }}">
            {% if u.role == 'administrator' %}‚ö°Ô∏è –ê–¥–º–∏–Ω{% else %}üë§ –ò–≥—Ä–æ–∫{% endif %}
        </span>
    </td>
    <td>
        <div class="table-btns">
            {% if u.user_id != user.user_id %}
                <!-- –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ä–æ–ª–∏ -->
                <form action="{% url 'admin_toggle_role' u.user_id %}" method="post" style="margin:0;">
                    {% csrf_token %}
                    <button type="submit" class="admin-btn-hex role-toggle {% if u.role == 'administrator' %}active{% endif %}"
                            title="–ò–∑–º–µ–Ω–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞">
                        <span class="icon">üîë</span>
                    </button>
                </form>

                <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
                <form action="{% url 'admin_delete_user' u.user_id %}" method="post" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–∏—Å—Ç–µ–º—ã?')">
                    {% csrf_token %}
                    <button type="submit" class="admin-btn-hex delete" title="–°—Ç–µ—Ä–µ—Ç—å –∞–∫–∫–∞—É–Ω—Ç">
                        <span class="icon">üóë</span>
                    </button>
                </form>
            {% else %}
                <span class="text-muted" style="font-size: 0.8rem;">(–≠—Ç–æ –≤—ã)</span>
            {% endif %}
        </div>
    </td>
</tr>
{% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function openTab(tabName) {
    let contents = document.getElementsByClassName("tab-content");
    let buttons = document.getElementsByClassName("tab-btn");
    for (let i = 0; i < contents.length; i++) {
        contents[i].classList.remove("active");
        buttons[i].classList.remove("active");
    }
    document.getElementById(tabName).classList.add("active");
    event.currentTarget.classList.add("active");
}
</script>

<style>
    .admin-wrapper { padding: 40px 0; }
    .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .admin-header h1 span { color: var(--accent); text-shadow: 0 0 15px var(--accent-glow); }

    .stats-bar { display: flex; gap: 20px; }
    .stat-item { background: var(--card-bg); padding: 10px 20px; border-radius: 8px; border: 1px solid var(--glass-border); font-size: 0.9rem; }
    .stat-item span { color: var(--accent); font-weight: 800; }

    /* –¢–∞–±—ã */
    .admin-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid var(--glass-border); padding-bottom: 10px; }
    .tab-btn { background: none; border: none; color: var(--text-muted); padding: 10px 20px; cursor: pointer; font-weight: 700; transition: 0.3s; }
    .tab-btn.active { color: var(--accent); border-bottom: 2px solid var(--accent); }

    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.4s; }

    /* –¢–∞–±–ª–∏—Ü–∞ */
    .cyber-table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 12px; overflow: hidden; }
    .cyber-table th { padding: 15px; text-align: left; background: rgba(255,255,255,0.05); color: var(--accent); font-size: 0.8rem; text-transform: uppercase; }
    .cyber-table td { padding: 15px; border-bottom: 1px solid var(--glass-border); color: var(--text-muted); }

    .table-btns { display: flex; gap: 15px; align-items: center; }
    .btn-delete-icon { background: none; border: none; cursor: pointer; font-size: 1.1rem; filter: grayscale(1); transition: 0.3s; }
    .btn-delete-icon:hover { filter: grayscale(0); transform: scale(1.2); }

    .role-tag { padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; text-transform: uppercase; font-weight: 800; }
    .role-tag.administrator { background: rgba(255, 75, 43, 0.2); color: var(--danger); }
    .role-tag.player { background: rgba(0, 210, 255, 0.2); color: var(--accent); }

    .content-actions { margin-bottom: 20px; }
    .text-white { color: #fff; font-weight: 600; }
</style>
{% endblock %}